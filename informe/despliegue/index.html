
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Automatizaci贸n de Infraestructura en Azure con Terraform y Ansible">
      
      
        <meta name="author" content="Carlos Grande">
      
      
      
        <link rel="prev" href="../arquitectura/configuracion/">
      
      
        <link rel="next" href="../evidencias/">
      
      
      <link rel="icon" href="../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Despliegue - Unir CP2</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/pdf-custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#despliegue-de-la-infraestructura" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Unir CP2" class="md-header__button md-logo" aria-label="Unir CP2" data-md-component="logo">
      
  <img src="../../assets/images/favicon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Unir CP2
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Despliegue
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B煤squeda" placeholder="B煤squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b煤squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/charlstown/unir-cp2" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Pesta帽as" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Inicio

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Informe

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navegaci贸n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Unir CP2" class="md-nav__button md-logo" aria-label="Unir CP2" data-md-component="logo">
      
  <img src="../../assets/images/favicon.svg" alt="logo">

    </a>
    Unir CP2
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/charlstown/unir-cp2" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Informe
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Informe
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../arquitectura/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Arquitectura
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Arquitectura
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arquitectura/infraestructura/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infraestructura
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arquitectura/configuracion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuraci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Despliegue
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Despliegue
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#despliegue-de-la-infraestructura" class="md-nav__link">
    <span class="md-ellipsis">
      Despliegue de la infraestructura
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicacion-de-las-imagenes" class="md-nav__link">
    <span class="md-ellipsis">
      Publicaci贸n de las imagenes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Publicaci贸n de las imagenes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#publicacion-de-las-imagenes-mediante-ansible" class="md-nav__link">
    <span class="md-ellipsis">
      Publicaci贸n de las im谩genes mediante Ansible
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publicacion-mediante-github-actions-fuera-de-alcance" class="md-nav__link">
    <span class="md-ellipsis">
      Publicaci贸n mediante Github Actions (fuera de alcance)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-la-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Configuraci贸n de la VM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-del-aks" class="md-nav__link">
    <span class="md-ellipsis">
      Configuraci贸n del AKS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../evidencias/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evidencias
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../licencia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Licencia
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../referencias/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#despliegue-de-la-infraestructura" class="md-nav__link">
    <span class="md-ellipsis">
      Despliegue de la infraestructura
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicacion-de-las-imagenes" class="md-nav__link">
    <span class="md-ellipsis">
      Publicaci贸n de las imagenes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Publicaci贸n de las imagenes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#publicacion-de-las-imagenes-mediante-ansible" class="md-nav__link">
    <span class="md-ellipsis">
      Publicaci贸n de las im谩genes mediante Ansible
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publicacion-mediante-github-actions-fuera-de-alcance" class="md-nav__link">
    <span class="md-ellipsis">
      Publicaci贸n mediante Github Actions (fuera de alcance)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-la-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Configuraci贸n de la VM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-del-aks" class="md-nav__link">
    <span class="md-ellipsis">
      Configuraci贸n del AKS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="despliegue">Despliegue<a class="headerlink" href="#despliegue" title="Permanent link">&para;</a></h1>
<p>A continuaci贸n, se explica c贸mo reproducir los pasos necesarios para llevar a cabo el caso pr谩ctico sobre el repositorio. Se detallan las instrucciones para:</p>
<ul>
<li><a href="#despliegue-de-la-infraestructura">1. Despliegue de la infraestructura</a></li>
<li><a href="#publicacion-de-las-imagenes">2. Publicaci贸n de las imagenes</a></li>
<li><a href="#configuracion-de-la-vm">3. Configuraci贸n de la VM</a></li>
<li><a href="#configuracion-del-aks">4. Configuraci贸n del AKS</a></li>
</ul>
<hr />
<h2 id="despliegue-de-la-infraestructura">Despliegue de la infraestructura<a class="headerlink" href="#despliegue-de-la-infraestructura" title="Permanent link">&para;</a></h2>
<p>El despliegue de la infraestructura se realiza con Terraform desde la m谩quina local, asegurando que la configuraci贸n es v谩lida antes de aplicar los cambios y provisionar los recursos necesarios.</p>
<ol>
<li>
<p>Inicializa terraform en el directorio de ficheros terraform.</p>
<p><div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>-chdir<span class="o">=</span>./terraform<span class="w"> </span>init
</code></pre></div>
Output: <code>Terraform has been successfully initialized!</code></p>
</li>
<li>
<p>Ejecuta la validaci贸n de los ficheros generados con el siguiente comando:</p>
<p><div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>validate
</code></pre></div>
output: <code>Success! The configuration is valid.</code></p>
</li>
<li>
<p>Despliega la infraestructura con el siguiente comando, por defecto se despliega en dev. Siempre puedes a帽adir el flag <code>-var="environment=pro"</code> para especificar un entorno entre <code>dev|pre|pro</code></p>
<div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>-chdir<span class="o">=</span>./terraform<span class="w"> </span>apply<span class="w"> </span>--auto-approve
</code></pre></div>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Automatizaci贸n de variables</p>
<p>Tras el despliegue de toda la infraestructura se generan autom谩ticamente las variables globales necesarias para poder realizar lo que queda del ejercicio ejecutando el fichero <code>setup.sh</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>setup.sh
</code></pre></div>
</div>
<h2 id="publicacion-de-las-imagenes">Publicaci贸n de las imagenes<a class="headerlink" href="#publicacion-de-las-imagenes" title="Permanent link">&para;</a></h2>
<h3 id="publicacion-de-las-imagenes-mediante-ansible">Publicaci贸n de las im谩genes mediante Ansible<a class="headerlink" href="#publicacion-de-las-imagenes-mediante-ansible" title="Permanent link">&para;</a></h3>
<p>Para publicar im谩genes en el ACR utilizando Ansible, se ha creado un playbook llamado <code>publish-images.yaml</code>. Para llevar a cabo su ejecuci贸n, es necesario es necesario ejecutar desde el directorio de ansible el siguiente comando.</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>publish_images.yml<span class="w"> </span>-i<span class="w"> </span>hosts.yml<span class="w"> </span>--ask-vault-pass
</code></pre></div>
<p>Este comando construye la imagen de MkDocs, descarga la imagen p煤blica de StackEdit y publica ambas im谩genes en el ACR desde la VM.</p>
<h3 id="publicacion-mediante-github-actions-fuera-de-alcance">Publicaci贸n mediante Github Actions (fuera de alcance)<a class="headerlink" href="#publicacion-mediante-github-actions-fuera-de-alcance" title="Permanent link">&para;</a></h3>
<p>En este apartado se explica la publicaci贸n de im谩genes en el ACR utilizando GitHub Actions. Aunque no formaba parte del alcance del ejercicio, se ha implementado este m茅todo para probar un flujo habitual en proyectos donde un repositorio genera y publica im谩genes de contenedor tras una release.</p>
<p>La publicaci贸n de la imagen se automatiza mediante el workflow <a href="https://github.com/charlstown/unir-cp2/actions/workflows/publish-image-mkdocs.yml"><code>Publish mkdocs image to ACR</code></a> de GitHub Actions, que env铆a la imagen al Azure Container Registry (ACR). Para ello, se deben proporcionar las credenciales adecuadas y validar la ejecuci贸n del proceso.</p>
<ol>
<li>
<p>Rellenar los datos del formulario del workflow con username y pwd del ACR desplegado en Azure.</p>
<details class="note">
<summary>Visualizar usuario y contrase帽a del ACR</summary>
<p>Siempre puedes ejecutar este comando para recuperar el usuario y la contrase帽a del ACR.</p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>acr<span class="w"> </span>credential<span class="w"> </span>show<span class="w"> </span>--name<span class="w"> </span>acrweucp2dev<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;[username, passwords[0].value]&quot;</span><span class="w"> </span>-o<span class="w"> </span>tsv
</code></pre></div>
</details>
<p><img alt="Workflow form" src="../../assets/images/run-workflow-form.png" /></p>
</li>
<li>
<p>Ejecutar workflow y validar la correcta ejecuci贸n del job</p>
</li>
</ol>
<h2 id="configuracion-de-la-vm">Configuraci贸n de la VM<a class="headerlink" href="#configuracion-de-la-vm" title="Permanent link">&para;</a></h2>
<p>La configuraci贸n de la VM se llevar谩 a cabo desde la m谩quina local utilizando Ansible, accediendo por SSH para realizar comprobaciones y garantizar el correcto despliegue del entorno.</p>
<ol>
<li>
<p>Comprobar conexi贸n a la VM por SSH</p>
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-i<span class="w"> </span>~/.ssh/az_unir_rsa<span class="w"> </span>charlstown@<span class="si">${</span><span class="nv">VM_IP</span><span class="si">}</span>
<span class="nb">exit</span>
</code></pre></div>
</li>
<li>
<p>Ejecutar ansible apuntando a la VM. Asegurarse que el comando se ejecuta desde <code>./ansible</code>. Para forzar ansible a recrear todo desde el principio es posible usar los argumentos <code>--force-handlers</code> y <code>--extra-vars "recreate=true"</code>.</p>
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>ansible/playbook.yml<span class="w"> </span>-i<span class="w"> </span>ansible/hosts.yml<span class="w"> </span>--extra-vars<span class="w"> </span><span class="s2">&quot;@ansible/vars.yml&quot;</span><span class="w"> </span>--ask-vault-pass
</code></pre></div>
<p>Este playbook se ejecuta apuntando a un Vault de ansible donde se han guardado las credenciales usadas para crear el fichero <code>htpasswd.users</code> en la carpeta <code>/etc/nginx/auth/htpasswd.users</code> de la VM.</p>
<details class="note">
<summary>Mostrar contrase帽as guardadas en el vault</summary>
<p>Para visualizar las contrase帽as guardadas en el vault puedes ejecutar el comando:
<div class="highlight"><pre><span></span><code>ansible-vault<span class="w"> </span>view<span class="w"> </span>secrets.yml
</code></pre></div></p>
</details>
</li>
</ol>
<h2 id="configuracion-del-aks">Configuraci贸n del AKS<a class="headerlink" href="#configuracion-del-aks" title="Permanent link">&para;</a></h2>
<p>El despliegue de la aplicaci贸n en el cl煤ster de Kubernetes se realiza mediante Ansible, aplicando los manifiestos necesarios para crear el namespace, el deployment, el PersistentVolumeClaim, el Service y el secret de acceso al ACR. Todo el proceso queda automatizado en el playbook <code>playbook_aks.yml</code>.</p>
<ol>
<li>
<p>Descargar credenciales del AKS para interactuar con el cl煤ster desde kubectl.</p>
<p>El siguiente comando guarda las credenciales del AKS en <code>/home/&lt;USER&gt;/.kube/config</code> y marca como contexto el AKS seleccionado.</p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>aks<span class="w"> </span>get-credentials<span class="w"> </span>--resource-group<span class="w"> </span>rg-weu-cp2-dev<span class="w"> </span>--name<span class="w"> </span>aks-weu-cp2-dev
</code></pre></div>
</li>
<li>
<p>Ejecutar el playbook de Ansible para desplegar la aplicaci贸n en AKS. Este comando debe lanzarse desde la ra铆z del proyecto.</p>
<div class="highlight"><pre><span></span><code>ansible-playbook playbook_aks.yml -i hosts.yml --ask-vault-pass
</code></pre></div>
</li>
<li>
<p>Para obtener la IP p煤blica del servicio y acceder a la aplicaci贸n desplegada, ejecuta el siguiente comando.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>stackedit-service<span class="w"> </span>-n<span class="w"> </span>cp2<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.status.loadBalancer.ingress[0].ip}&quot;</span>
</code></pre></div>
<p>La aplicaci贸n estar谩 disponible en esa direcci贸n IP a trav茅s del puerto 80.</p>
</li>
</ol>
<p> Con estos pasos, se completa el despliegue y configuraci贸n 铆ntegra del caso pr谩ctico: se ha provisionado toda la infraestructura necesaria, se han publicado las im谩genes de contenedor en el ACR, y se ha puesto en marcha tanto la VM como el cl煤ster de AKS. El entorno queda totalmente funcional, con los contenedores desplegados y ejecut谩ndose a partir de sus respectivas im谩genes.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Pie" >
        
          
          <a href="../arquitectura/configuracion/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Configuraci贸n">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                Configuraci贸n
              </div>
            </div>
          </a>
        
        
          
          <a href="../evidencias/" class="md-footer__link md-footer__link--next" aria-label="Siguiente: Evidencias">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Siguiente
              </span>
              <div class="md-ellipsis">
                Evidencias
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Unir CP2 - 2025
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.sections", "navigation.footer", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.tabs.link", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../assets/javascripts/extra.js"></script>
      
        <script src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
      
        <script src="../../assets/javascripts/drawio-reload.js"></script>
      
    
  </body>
</html>